<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pivot Bot Backtest Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2 class="mb-4">Pivot Bot Backtest Dashboard</h2>
    <form method="post" enctype="multipart/form-data" class="mb-4">
        <div class="mb-3">
            <label for="file" class="form-label">Upload CSV file (Date/Time, Open, High, Low, Close, Volume):</label>
            <input class="form-control" type="file" name="file" id="file" required>
        </div>
    <!-- Removed SL/TP/risk fields for simple backtest UI -->
        <button type="submit" class="btn btn-primary">Run Backtest</button>
    </form>
    {% if error_message %}
        <div class="alert alert-danger">{{ error_message }}</div>
    {% endif %}
    {% if chart_html %}
        <div class="card mb-3">
            <div class="card-body">
                <h5 class="card-title">Account Growth (Equity Curve)</h5>
                {{ chart_html|safe }}
            </div>
        </div>
        <div class="alert alert-info">
            <strong>Win Rate:</strong> {{ '%.2f' % (win_rate*100 if win_rate is not none else 0) }}%<br>
            <strong>Lose Rate:</strong> {{ '%.2f' % (lose_rate*100 if lose_rate is not none else 0) }}%
        </div>
        {% if trade_details %}
        <div class="card mt-4">
            <div class="card-body">
                <h5 class="card-title">Trade Details</h5>
                <div style="overflow-x:auto; max-height:400px;">
                <table class="table table-sm table-bordered table-striped">
                    <thead class="table-light">
                        <tr>
                            <th>#</th>
                            <th>Time</th>
                            <th>Type</th>
                            <th>Entry</th>
                            <th>SL</th>
                            <th>TP</th>
                            <th>Result</th>
                            <th>PnL</th>
                            <th>Balance</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for t in trade_details %}
                        <tr>
                            <td>{{ loop.index }}</td>
                            <td>{{ t['Time'] }}</td>
                            <td>{{ t['Type'] }}</td>
                            <td>{{ '%.2f' % t['Entry'] }}</td>
                            <td>{{ '%.2f' % t['SL'] }}</td>
                            <td>{{ '%.2f' % t['TP'] }}</td>
                            <td>{{ t['Result'] }}</td>
                            <td>{{ '%.2f' % t['PnL'] }}</td>
                            <td>{{ '%.2f' % t['Balance'] }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                </div>
            </div>
        </div>
        {% endif %}
    {% endif %}
</div>
</body>
</html>
